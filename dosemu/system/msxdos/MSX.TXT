---------------------------------------------------------------------
  MSX-DOS Emulator Ver 0.09

                                  Copyright 1995,1996,2009 Inatcher
                                               NIFTY-Serve NCD02444
---------------------------------------------------------------------
０．はじめに

　　以前から、ＭＳ−ＤＯＳ上でＭＳＸ−Ｃが使えるＭＳＸ−ＤＯＳの
　エミュレータが欲しいと思っていたので作ってみました。

　　ＭＳ−ＤＯＳ汎用、ＣＰＵは８０８６系が必要です。


１．使い方

　　A>MSX [MSX-DOSコマンド] [オプション指定]

　　ＭＳＸ−ＤＯＳ上で指定するパラメーターの前にＭＳＸを付けます。
　　なお、ＭＳＸ−ＤＯＳコマンドは拡張子も指定しなければいけません。

　　例．A>MSX CAL.COM /Y1995


２．制限事項など

　・インタースロットコールは下記のＭＳＸ−ＢＩＯＳ以外はサポート
　　していない。
　・ＭＳＸ−ＢＩＯＳは以下のものをサポート。ただし、ＣＡＬＳＬＴ
　（００１ＣＨ）をコールした時のみ。

　　005FH スクリーンモード変更
　　　　　スクリーン０と１のみ
　　006CH スクリーン０にセット
　　006FH スクリーン１にセット
　　　　　これらは、画面を消去し、それぞれＦ３ＡＥＨ、Ｆ３ＡＦＨの
　　　　値をＦ３Ｂ０Ｈにセットします。

　　009FH １文字入力
　　00A2H １文字表示
　　00A5H １文字プリンタ出力
　　00C0H ブザーを鳴らす
　　00C3H 画面クリア
　　00C6H カーソルの移動

　　　これらの中には、エスケープシーケンスを使用しているものもあるので
　　ＡＴ互換機ではＣＯＮＦＩＧ．ＳＹＳでＡＮＳＩ．ＳＹＳを組み込んで
　　おく必要があります。

　・システムコール１８Ｈ（ログインベクトル）は、ＣＯＮＦＩＧ．ＳＹＳ
　　のＬＡＳＴＤＲＩＶＥ＝で指定した値、または合計ドライブのいずれか
　　多い方で調べるので実際には接続されていないドライブが接続されて
　　いると返る可能性があります。
　・システムコール１ＢＨ（ディスク情報）でＩＸ、ＩＹレジスタの値を
　　設定しません。
　・システムコール２ＦＨ、３０Ｈ（論理セクタの読み書き）は、ＡＴ互換機
　　以外で動作するか確認していません。（ＩＮＴ ２５Ｈ、２６Ｈ使用）
　　機種チェックはしていないので、ＡＴ互換機以外では注意して下さい。
　・システムコール６ＦＨ（MSX-DOSのバージョン番号の獲得）は、１．０３
　　を返すので、間違ってＭＳＸ−ＤＯＳ２のコマンドを動かしても大丈夫？

　・ＭＳＸのエスケープシーケンスには対応していません。
　・スタックの開始アドレスは、ＥＦＦＦＨとしました。
　・ＭＳＸのワークエリアの値は、

　　Ｆ３ＡＥＨ＝４０（スクリーン０の時の画面の桁数）
　　Ｆ３ＡＦＨ＝３２（スクリーン１の時の画面の桁数）
　　Ｆ３Ｂ０Ｈ＝８０（画面の桁数）
　　Ｆ３Ｂ１Ｈ＝２５（画面の行数）

　　のみ設定しています。

　・確保されているメモリは ００００Ｈ〜ＦＦＥ０Ｈ番地なので、これを
　　越えたアドレスを参照した時の値は保証できない。
　・IM0 IM1 IM2 EI DI は NOP と RETI RETN は RET と同じ動作をします。
　・Ｒレジスタ、Ｉレジスタの動作は考慮して有りません。
　・ステートとかは考慮していないので、命令でタイミングをとるような
　　ものは正常に動作しません。


３．使用にあたって

　・ＭＳＸ．ＥＸＥ（以下、本ソフト）は無料で使用できます。
　・本ソフトの使用による損害等は全く保証しない。
　・本ソフトを配布する時に、実費以外の金銭を請求してはいけません。
　　必ずオリジナルの MSX.EXE MSX.DOC を配布して下さい。

　作者への連絡は ncd02444@nifty.ne.jp までメールを下さい。

４．その他

　　最初は、村上氏のＣＰＭ０４（当時の最新版は０６）を改造して作る
　つもりだったのですが、ＯＰＴＡＳＭを持っていないのでアセンブル
　できず、あきらめて１からＣで作成しました。しかし、ＣＰＭ０４が
　無ければ、このソフトが作られることはなかったでしょう。村上氏に
　感謝します。

　　動作確認は、MSX-DOS TOOLS の一部と MSX-C 1.1 等でしました。
　　ただし、リンカなどはＣＰＭ０６で動作させた方が速いです。(;_;)
　　ＣＰＭ０６も手に入れて、組み合わせて使うべきでしょう。

　　Ver0.09でデバッグしてみて
　　WindowsXP のコマンドプロンプトでァイルを多数オープンする
　プログラムを使う場合、（FCBが使えませんと表示される場合）
　SystemRoot%\System32 フォルダ内（通常は C:\Windows\System32）
　の Config.nt に

　fcbs=8

　を追加する必要があります。（数値は必要な数に変更してください）

５．参考文献など

　ＭＳＸ−ＤＯＳスーパーハンドブック　　　ＢＩＴＳ 著
　ＭＳＸ−ＤＯＳアセンブラプログラミング　蔭山哲也 著
　パワーアップ・マシン語入門　　　　　　　瀬木信彦 著 
　Ｚ−８０アセンブラプログラミング入門　　湯田幸八・伊藤彰 共著
　ＭＳＸ−Ｄａｔａｐａｃｋ　　　　　　　　（株）アスキー
　ＭＳＸ−Ｄａｔａｐａｃｋ ｔｕｒｂｏＲ版 （株）アスキー
　はじめて読む８０８６　　　　　　　　　　蒲地輝久 著　村瀬康司 監修
　プログラマーのためにＰＣソースブック　　Thom Hogan 著 ＳＥ編集部 訳編
　プログラミング言語Ｃ　　　　　　　　　　B.W.カーニハン、D.M.リッチー 著
　　　　　　　　　　　　　　　　　　　　　石田晴久 訳
　ＶＣ＋＋ヘルプ　　　　　　　　　　　　　Microsoft Corp.

　CP/M program EXEcuter V0.5 のソース（村上敬司氏 作)
　CP/M80 2.2 emulation for OS/2 and DOS のソース（R. Griech氏 作）
　HOJA-x ver1.5 で出力したアセンブラソース（オオバ マサキ氏 作）

　各ソフトの作者に感謝。

　Ver0.06 でバグを発見、デバッグに協力いただいた逸見氏
　Ver0.08 でバグを発見された、XPのコマンドプロンプトの情報提供された宮本氏
　お二人に感謝。m(__)m


６．履歴

  1995/06/11 V0.01      初版公開
             V0.02      ファイルのリネームができないバグを修正
  1995/06/13 V0.03      セクタリード・ライトのバグを修正
                        簡単な MSX-BIOS をサポート
  1995/06/17 V0.04      システムコール１２Ｈのバグ修正
  1995/07/18            ドキュメントの間違いを訂正
                        オプティマイズオプションをＭＡＸでコンパイル
  1995/08/13 V0.05      スタック開始アドレスを FE06H から EFFFH に変更
                        ドキュメントの間違いを訂正
  1996/03/06 V0.06      内部処理を高速化
  1996/09/22 V0.07      LD A,(IX+d) 等の命令で、ｄの符号を考慮していなかっ
                        た。
  1998/07/30 V0.08      コンパイルオプションの変更、実行サイズを縮小
  2009/06/09 V0.09      ファンクション２７Ｈ、２８Ｈの戻り値Ａレジスタの値
                        が正しくなかった。
                        ＤＭＡアドレスの初期値を設定してなかった。
  2009/07/05            ドキュメントにWindowsXPのコマンドプロンプトで使用する
                        時の情報追加。
